//includeConfig 'experiment.config'

manifest.version = '2.0.1'


/*
** bbi-dmux process profiles.
** Notes:
**   o  a profile defines process block-specific directives
**   o  the 'standard' profile is used by default. Alternate
**      profiles are selected on the command line, e.g.,
**
**        nextflow run -profile <my_profile> main.nf
**
**   o  the standard profile here defines directive values 
**      that are used on the UW Genome Sciences computing 
**      cluster.
**   o  there can be more than one configuration script. The
**      Nextflow documentation explains
**
**        When a pipeline script is launched Nextflow looks for
**        a file named nextflow.config in the current directory
**        and in the script base directory (if it is not the
**        same as the current directory). Finally it checks for
**        the file $HOME/.nextflow/config.
**
**        When more than one of the above files exist they are
**        merged, so that the settings in the first override
**        the same ones that may appear in the second one, and
**        so on.
**
**        The default config file search mechanism can be
**        extended proving an extra configuration file by using
**        the command line option -c <config file>.
**
**        It's worth noting that by doing this, the files
**        nextflow.config and $HOME/.nextflow/config are not
**        ignored and they are merged as explained above.
**
**        If you want to ignore any default configuration
**        files and use only the custom one use the command
**        line option -C <config file>.
**
**  o  selectors priority
**       When mixing generic process configuration and selectors
**       the following priority rules are applied (from lower
**       to higher):
**
**         1.  Process generic configuration.
**         2.  Process specific directive defined in the workflow
**             script.
**         3.  withLabel selector definition.
**         4.  withName selector definition.
**
**  o  a 'withName:' block defines directives used in the
**     process block with the same names.
**  o  at the BBI we use modules to access required programs
**     so module directives are in the standard profiles.
**  o  programs installed locally can be accessed by modifying
**     the PATH environment variable by adding the directories
**     in which the programs can be found. Use the 
**     'beforeScript' directive for this purpose, for example
**
**       beforeScript = 'export PATH=/opt/python/bin:$PATH'
*/
profiles {
  standard {
    process {
      beforeScript =  '. /etc/profile.d/modules.sh'
      executor = "sge"
      errorStrategy = "finish"
      queue = "shendure-long.q"
      maxForks = 20
      clusterOptions = "-l centos=7"

      withName: generate_sheets {
        module = 'modules:modules-init:modules-gs:python/3.7.7'
        memory = '1 GB'
      }

      withName: check_sample_sheet {
        module = 'modules:modules-init:modules-gs:python/3.7.7'
        memory = '1 GB'
      }

      withName: make_sample_sheet {
        module = 'modules:modules-init:modules-gs:python/3.7.7'
        memory = '1 GB'
      }

      withName: bcl2fastq {
        module = 'modules:modules-init:modules-gs:gmp/6.1.2:mpfr/4.0.1:mpc/1.1.0:gcc/8.1.0:bcl2fastq/2.20'
        penv = 'serial'
      }

      withName: seg_sample_fastqs1 {
        module = 'modules:modules-init:modules-gs:python/3.7.7:zlib/1.2.11:pigz/2.3'
        cpus = 8
        memory = '1 GB'
        penv = 'serial'
      }

      withName: demux_dash1 {
        module = 'modules:modules-init:modules-gs:gcc/8.1.0:R/3.6.1'
        memory = '8 GB'
      }

      withName: seg_sample_fastqs2 {
        module = 'modules:modules-init:modules-gs:python/3.7.7:zlib/1.2.11:pigz/2.3'
        penv = 'serial'
        cpus = 8
        memory = '1 GB'
      }

      withName: recombine_fastqs {
        module = 'modules:modules-init:modules-gs:python/3.7.7'
      }

      withName: recombine_csvs {
        module = 'modules:modules-init:modules-gs:python/3.7.7'
      }

      withName: recombine_jsons {
        module = 'modules:modules-init:modules-gs:python/3.7.7'
      }

      withName: demux_dash {
        module = 'modules:modules-init:modules-gs:gcc/8.1.0:R/3.6.1'
        memory = '8 GB'
      }

      withName: run_recovery {
        module = 'modules:modules-init:modules-gs:python/3.7.7'
        memory = '4 GB'
      }

      withName: sum_recovery {
        module = 'modules:modules-init:modules-gs:python/3.7.7'
        memory = '4 GB'
      }

    } // end of process
  } // end of standard profile

  centos_6 {
    process {
      beforeScript =  '. /etc/profile.d/modules.sh'
      executor = "sge"
      errorStrategy = "finish"
      queue = "shendure-long.q"
      maxForks = 20
      clusterOptions = "-l centos=6"

      withName: generate_sheets {
        module = 'modules:modules-init:modules-gs:python/3.6.4'
        memory = '1 GB'
      }

      withName: check_sample_sheet {
        module = 'modules:modules-init:modules-gs:python/3.6.4'
        memory = '1 GB'
      }

      withName: make_sample_sheet {
        module = 'modules:modules-init:modules-gs:python/3.6.4'
        memory = '1 GB'
      }

      withName: bcl2fastq {
        module = 'modules:modules-init:modules-gs:gmp/5.0.2:mpfr/3.1.0:mpc/0.8.2:gcc/4.9.1:bcl2fastq/2.20'
        penv = 'serial'
      }

      withName: seg_sample_fastqs1 {
        module = 'modules:modules-init:modules-gs:python/3.6.4:zlib/1.2.6:pigz/2.3'
        cpus = 8
        memory = '1 GB'
        penv = 'serial'
      }

      withName: demux_dash1 {
        module = 'modules:modules-init:modules-gs:gcc/8.1.0:R/3.6.1'
        memory = '8 GB'
      }

      withName: seg_sample_fastqs2 {
        module = 'modules:modules-init:modules-gs:python/3.6.4:zlib/1.2.6:pigz/2.3'
        penv = 'serial'
        cpus = 8
        memory = '1 GB'
      }

      withName: recombine_fastqs {
        module = 'modules:modules-init:modules-gs:python/3.6.4'
      }

      withName: recombine_csvs {
        module = 'modules:modules-init:modules-gs:python/3.6.4'
      }

      withName: recombine_jsons {
        module = 'modules:modules-init:modules-gs:python/3.6.4'
      }

      withName: demux_dash {
        module = 'modules:modules-init:modules-gs:gcc/8.1.0:R/3.6.1'
        memory = '8 GB'
      }

      withName: run_recovery {
        module = 'modules:modules-init:modules-gs:python/3.6.4'
        memory = '4 GB'
      }

      withName: sum_recovery {
        module = 'modules:modules-init:modules-gs:python/3.6.4'
        memory = '4 GB'
      }

    } // end of process
  } // end of centos_6 profile

}  // end of profiles
